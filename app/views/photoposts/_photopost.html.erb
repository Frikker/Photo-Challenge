<% if (photopost_counter%3).zero? %>
  <tr>
<% end %>
  <td id="photopost">
    <div class="content">
      <% if params[:controller] == 'users' %>
        <h6> <%= photopost.aasm_state %></h6>
      <% end %>
      <h5 class="text-content"><%= photopost.content %></h5>
      <div class="image-content">
        <% if photopost.picture? %>
          <%= image_tag photopost.picture.url if params[:controller] == 'main_pages' %>
          <%= image_tag photopost.picture.users.url if params[:controller] == 'users' %>
        <% end %>
      </div>
    </div>
    <ul class="icon-list">
      <h6 class="timestamp">
        Posted <%= time_ago_in_words(photopost.created_at) %> ago.
      </h6>
      <li><ul>
        <li><%= link_to image_tag(photopost.user.image, class: 'avatar'), photopost.user %></li>
        <li><h4 class="user"><%= link_to photopost.user.first_name, photopost.user %></h4></li>
      </ul></li>
      <li class="likes">
        <% if check_likes(photopost) %>
          <%= form_with(url: photopost_ratings_path(photopost), class: "likes-#{photopost.id}", method: 'delete') do |f|%>
            <%= photopost.rating.count %>
            <%= f.submit '', type: :image, src: image_path('filled_heart.svg'), onclick: "update_block('#{request.original_fullpath}', 'likes-#{photopost.id}')", class: 'icon', method: 'delete'%>
          <% end %>
        <% else %>
          <%= form_with(url: photopost_ratings_path(photopost), class: "likes-#{photopost.id}") do |f|%>
            <%= photopost.rating.count %>
            <%= f.submit '', type: :image, src: image_path('heart.svg'), onclick: "update_block('likes-#{photopost.id}')", class: 'icon', method: 'post'%>
          <% end %>
        <% end %>
      </li>
      <li class="comments">
        <%= photopost.comments.count %>
        <%= link_to image_tag(image_path('comment.svg'), class: 'icon'), photopost_path(photopost.id) %>
      </li>
    </ul>
  </td>
<% if photopost == @photoposts.last && !((@photoposts.count % 3).zero?) %>
  <% (3 - (@photoposts.count % 3)).times do %>
    <%= render 'photoposts/empty_photopost_cell' %>
  <% end %>
<% end %>
<script>
    function update_block(block){
        $('.'+block).html("<%= escape_javascript photopost.rating.count %>");
    }
</script>